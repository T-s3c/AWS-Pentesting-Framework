# Recon and Enumeration

The first phase of the Outsider is the Recon and Enumeration phase.

### OSINT

Look for urls that contains <alias>.signin.aws.amazon.com with an alias related to the organization.

### Marketplace

If a vendor has instances in the marketplace, you can get the owner id (account id) of the AWS account he used.

### Snapshots

- Git, Github, Gitlab
- Share-stuff
- API Collections
- Search in Developer Plattforms
 Tools: git-hound
 
shed changes
Public EBS snapshots (EC2 -> Snapshots -> Public Snapshots)

RDS public snapshots (RDS -> Snapshots -> All Public Snapshots)

Public AMIs (EC2 -> AMIs -> Public images)

### Recon Tools
- [Thoth](https://github.com/r1cksec/thoth)
- ....


## 1.5 Recon/Enumeration: Api Gateway Unauthencticated Enum

### API Invoke Bypass
Lambda Authorizers can be configured using IAM syntax to give permissions to invoke API endpoints.

```
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Permission",
      "Action": [
        "execute-api:Execution-operation"           
      ],
      "Resource": [
        "arn:aws:execute-api:region:account-id:api-id/stage/METHOD_HTTP_VERB/Resource-path"
      ]
    }
  ]
} 
```

### IAM Policy Injection

the code is using user input to generate the IAM policies, wildcards (and others such as "." or specific strings) can be included in there with the goal of bypassing restrictions.

### Public URL template

```
https://{random_id}.execute-api.{region}.amazonaws.com/{user_provided}
```

## 1.6 Recon/Enumeration: Databases -> RDS Unauthenticated Enum

### Public Port

It's possible to expose the database port to the internet. 

### Public RDS Snapshots

```
# Public RDS snapshots
aws rds describe-db-snapshots --include-public
## Search by account ID
aws rds describe-db-snapshots --include-public --query 'DBSnapshots[?contains(DBSnapshotIdentifier, `284546856933:`) == `true`]'
## To share a RDS snapshot with everybody the RDS DB cannot be encrypted (so the snapshot won't be encryted)
## To share a RDS encrypted snapshot you need to share the KMS key also with the account


# From the own account you can check if there is any public snapshot with:
aws rds describe-db-snapshots --snapshot-type public [--region us-west-2]
## Even if in the console appear as there are public snapshot it might be public
## snapshots from other accounts used by the current account
```

### Public URL template

```
mysql://{user_provided}.{random_id}.{region}.rds.amazonaws.com:3306
postgres://{user_provided}.{random_id}.{region}.rds.amazonaws.com:5432
```

## Quelle:

https://cloud.hacktricks.xyz/pentesting-cloud/aws-pentesting/aws-unauthenticated-enum-access/aws-accounts-unauthenticated-enum
https://cloud.hacktricks.xyz/pentesting-cloud/aws-pentesting/aws-unauthenticated-enum-access/aws-s3-unauthenticated-enum
Gschwendo Twitter Feeds

## Tools I used in the last pentest

```
Cloudbrute -d <url> -k <something> -w wordlist
```

