## Metadata Service 

Metadata Service of EC2 Instanz
```
curl http://169.254.169.254/latest/meta-data
```

Metadata Service URL for Security Credentials
```
http://169.254.169.254/latest/meta-data/iam/security-credentials/
```

Request of IAM Credentials
```
http://169.254.169.254/latest/meta-data/iam/security-credentials/*role_name*/
```

Access to EC2 User Data
```
curl http://169.254.169.254/latest/user-data
```

### IMDSv2

In Version 2 the user has to create and use a token to access the metadata service. This technique adds a layer of protection against SSRF attacks.

```
TOKEN=`curl -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600"`
```

```
curl -H "X-aws-ec2-metadata-token: $TOKEN" -v http://169.254.169.254/latest/meta-data/
```


Request for available EBS Snapshots
```
aws ec2 describe-snapshots --restorable-by-user-ids all --owner-ids 000000000000
```

Request for Subnets
```
aws ec2 describe-subnets
```

Request for Security Groups
```
aws ec2 describe-security-groups
```

Automated approach with Prowler
```
./prowler -c ec2_ebs_public_snapshot
```















